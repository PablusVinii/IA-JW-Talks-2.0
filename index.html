<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Esbo√ßos - Testemunhas de Jeov√°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Menu Button -->
    <button onclick="abrirMenu()" class="menu-btn" aria-label="Abrir menu">
        ‚ò∞
        <span id="menuNotificacaoBadge" style="position:absolute;top:-5px;right:-5px;background:#ff4757;color:white;border-radius:50%;width:20px;height:20px;font-size:12px;display:none;align-items:center;justify-content:center;">0</span>
    </button>

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
        <a href="javascript:void(0)" class="closebtn" onclick="fecharMenu()" aria-label="Fechar menu">√ó</a>
        <div id="userInfo">üë§ Usu√°rio: carregando...</div>
        <a href="perfil.html" class="btn" style="margin: 16px 20px 0 20px; display:block; text-align:center;">‚öôÔ∏è Meu Perfil</a>
        <hr>
        <nav>
            <h3><span role="img" aria-label="Rel√≥gio">üïì</span> Hist√≥rico de Esbo√ßos</h3>
            <input type="text" id="buscaHistorico" placeholder="Buscar por tema, tipo ou data..." style="width:90%;margin:10px 5%;padding:8px;border-radius:6px;border:1px solid #ccc;outline:none;" />
            <ul id="historicoList">
                <!-- Hist√≥rico ser√° carregado aqui -->
            </ul>
        </nav>
        
        <hr>
        
        <!-- Se√ß√£o de Notifica√ß√µes -->
        <nav>
            <h3><span role="img" aria-label="Sino">üîî</span> Notifica√ß√µes <span id="notificacaoCount" style="background:#ff4757;color:white;padding:2px 6px;border-radius:10px;font-size:12px;display:none;">0</span></h3>
            <div id="notificacoesContainer" style="max-height:200px;overflow-y:auto;">
                <ul id="notificacoesList">
                    <!-- Notifica√ß√µes ser√£o carregadas aqui -->
                </ul>
            </div>
            <button onclick="marcarTodasComoLidas()" class="btn" style="margin:10px 20px;font-size:12px;padding:8px 16px;">‚úì Marcar como lidas</button>
        </nav>
        <hr>
        <button onclick="logout()" class="btn sair-btn">üö™ Sair</button>
    </aside>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="firebase-init.js"></script>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üìñ Gerador de Esbo√ßos</h1>
            <p>Testemunhas de Jeov√° - Prepara√ß√£o de discursos - Vers√£o 2.0</p>
        </header>

        <main class="main-content">
            <!-- Form Section -->
            <section class="form-section">
                <h2>Configurar Esbo√ßo</h2>
                
                <div class="form-group">
                    <label for="tipoDiscurso">Tipo de Discurso:</label>
                    <select id="tipoDiscurso" name="tipoDiscurso">
                        <option value="">Escolha uma op√ß√£o...</option>
                        <option value="publico">Discurso P√∫blico (Em breve...)</option>
                        <option value="pesquisa">Pesquisa B√≠blica Profunda</option>
                        <option value="tesouros">1. Tesouros da Palavra de Deus</option>
                        <option value="publico">4. Iniciando conversas (Em breve...)</option>
                        <option value="publico">5. Cultivando o interesse (Em breve...)</option>
                        <option value="publico">6. Explicando suas cren√ßas (Em breve...)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="tempo">Tempo estimado (minutos):</label>
                    <input type="number" id="tempo" name="tempo" placeholder="Digite o tempo em minutos..." min="1" max="10">
                </div>

                <div class="form-group">
                    <label for="tema">Tema Espec√≠fico:</label>
                    <input type="text" id="tema" name="tema" placeholder="Digite o tema do seu discurso...">
                </div>

                <div class="form-group">
                    <label for="versiculosOpicionais">Vers√≠culos B√≠blicos (opcional):</label>
                    <input type="text" id="versiculosOpicionais" name="versiculosOpicionais" placeholder="Ex: Jo√£o 3:16; Salmo 23:1; Mateus 6:33">
                </div>

                <div class="form-group">
                    <label for="topicosOpicionais">T√≥picos a serem abordados (opcional):</label>
                    <input type="text" id="topicosOpicionais" name="topicosOpicionais" placeholder="T√≥picos que voc√™ gostaria de incluir...">
                </div>

                <div class="form-group">
                    <label for="informacoesAdicionais">Informa√ß√µes Adicionais (opcional):</label>
                    <input type="text" id="informacoesAdicionais" name="informacoesAdicionais" placeholder="Ex: refer√™ncias extras, tom animador, exemplos pr√°ticos...">
                </div>

                <button class="btn" onclick="gerarEsboco()">
                    üîç Gerar Esbo√ßo
                </button>
            </div>

            <!-- Loading -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Buscando informa√ß√µes na biblioteca JW.org...</p>
            </div>

            <!-- Result Section -->
            <div class="result-section" id="resultSection">
                <div class="result-header">
                    <h2 class="result-title" id="resultTitle">Esbo√ßo Gerado</h2>
                    <p class="result-type" id="resultType">Discurso Personalizado</p>
                </div>

                <div class="pontos-section">
                    <h3 class="section-title">üìù Pontos Principais</h3>
                    <ul class="pontos-list" id="pontosList"></ul>
                </div>

                <div class="referencias-section">
                    <h3 class="section-title">üìö Conte√∫do Completo</h3>
                    <div class="referencias-list" id="referenciasList"></div>
                </div>

                <div class="download-section">
                    <button class="btn" id="btnDownload" onclick="baixarComoWord()">
                        üì• Baixar como Word
                    </button>
                    <button class="btn" onclick="exportarResultado()" style="margin-left: 10px;">
                        üìã Copiar Texto
                    </button>
                    <button class="btn" id="btnCompartilharEmail" style="margin-left: 10px;">
                        ‚úâÔ∏è E-mail
                    </button>
                    <button class="btn" id="btnCompartilharWhats" style="margin-left: 10px;">
                        üí¨ WhatsApp
                    </button>
                    <button class="btn" id="btnCompartilharLink" style="margin-left: 10px;">
                        üîó Link
                    </button>
                </div>
            </div>

            <!-- Error Message -->
            <div class="error" id="errorMessage" role="alert"></div>
        </section> <!-- Fechando form-section -->
        </main> <!-- Fechando main-content -->
    </div> 

    <!-- Footer -->
    <footer class="footer">
        <p>Desenvolvido por <a href="https://github.com/PablusVinii/" target="_blank">Pablus Vinii</a> - Estudante de Engenharia de Software</p>
    </footer>
    
    <!-- Sistema de Notifica√ß√µes Toast -->
    <div id="notificacaoToast" style="position:fixed;top:20px;right:20px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:15px 20px;border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,0.2);z-index:10000;transform:translateX(400px);transition:transform 0.3s ease;max-width:300px;">
        <div style="display:flex;align-items:center;gap:10px;">
            <span id="toastIcon" style="font-size:20px;">üîî</span>
            <div>
                <div id="toastTitulo" style="font-weight:600;margin-bottom:5px;">Nova Notifica√ß√£o</div>
                <div id="toastMensagem" style="font-size:14px;opacity:0.9;"></div>
            </div>
        </div>
        <button onclick="fecharNotificacaoToast()" style="position:absolute;top:5px;right:10px;background:none;border:none;color:white;cursor:pointer;font-size:16px;">√ó</button>
    </div>

    <script src="script.js"></script>

    <!-- Modal de Edi√ß√£o de Esbo√ßo -->
    <div id="modalEdicao" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.4);z-index:2000;align-items:center;justify-content:center;">
        <div style="background:#fff;padding:30px 20px;border-radius:12px;max-width:500px;width:95vw;box-shadow:0 8px 32px rgba(0,0,0,0.2);position:relative;">
            <button id="fecharModalEdicao" style="position:absolute;top:10px;right:15px;font-size:1.5em;background:none;border:none;cursor:pointer;">√ó</button>
            <h2 style="margin-bottom:18px;">Editar Esbo√ßo</h2>
            <form id="formEdicaoEsboco">
                <div style="margin-bottom:12px;">
                    <label for="edicaoTema">Tema:</label>
                    <input type="text" id="edicaoTema" name="edicaoTema" style="width:100%;padding:8px;margin-top:4px;" required />
                </div>
                <div style="margin-bottom:12px;">
                    <label for="edicaoTipo">Tipo de Discurso:</label>
                    <select id="edicaoTipo" name="edicaoTipo" style="width:100%;padding:8px;margin-top:4px;" required>
                        <option value="">Escolha uma op√ß√£o...</option>
                        <option value="publico">Discurso P√∫blico (Em breve...)</option>
                        <option value="pesquisa">Pesquisa B√≠blica Profunda</option>
                        <option value="tesouros">1. Tesouros da Palavra de Deus</option>
                        <option value="publico">4. Iniciando conversas (Em breve...)</option>
                        <option value="publico">5. Cultivando o interesse (Em breve...)</option>
                        <option value="publico">6. Explicando suas cren√ßas (Em breve...)</option>
                    </select>
                </div>
                <div style="margin-bottom:12px;">
                    <label for="edicaoConteudo">Conte√∫do:</label>
                    <textarea id="edicaoConteudo" name="edicaoConteudo" rows="8" style="width:100%;padding:8px;margin-top:4px;resize:vertical;" required></textarea>
                </div>
                <div style="text-align:right;">
                    <button type="button" id="cancelarEdicao" style="margin-right:10px;" class="btn btn-secondary">Cancelar</button>
                    <button type="submit" class="btn">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Visualiza√ß√£o Detalhada de Esbo√ßo -->
    <div id="modalDetalheEsboco">
        <div class="modal-content">
            <button id="fecharModalDetalhe">√ó</button>
            <h2 id="detalheTema"></h2>
            <div id="detalheTipo"></div>
            <div id="detalheData"></div>
            <div id="detalheConteudo"></div>
            <div style="text-align:right;">
                <button class="btn" id="btnDetalheCopiar">üìã Copiar</button>
                <button class="btn" id="btnDetalheExportar" style="margin-left:8px;">‚¨áÔ∏è Exportar</button>
                <button class="btn" id="btnDetalheEditar" style="margin-left:8px;">‚úèÔ∏è Editar</button>
                <button class="btn" id="btnDetalheEmail" style="margin-left:8px;">‚úâÔ∏è E-mail</button>
                <button class="btn" id="btnDetalheWhats" style="margin-left:8px;">üí¨ WhatsApp</button>
                <button class="btn" id="btnDetalheLink" style="margin-left:8px;">üîó Link</button>
            </div>
            <div id="msgModalDetalhe"></div>
        </div>
    </div>
</body>
</html>